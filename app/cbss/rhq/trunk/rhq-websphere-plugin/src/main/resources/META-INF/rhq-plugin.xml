<?xml version="1.0" encoding="UTF-8" ?>
<plugin name="WebSphere"
        displayName="WebSphere Application Server"
        package="be.fgov.kszbcss.rhq.websphere"
        pluginLifecycleListener="WebSpherePluginLifecycleListener"
        description="Supports management and monitoring of WebSphere Application Server"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns="urn:xmlns:rhq-plugin"
        xmlns:c="urn:xmlns:rhq-configuration">
    <depends plugin="JMX"/>
    <server name="WebSphere Server"
            discovery="be.fgov.kszbcss.rhq.websphere.component.server.WebSphereServerDiscoveryComponent"
            class="be.fgov.kszbcss.rhq.websphere.component.server.WebSphereServerComponent"
            description="WebSphere Application Server"
            supportsManualAdd="true">
        
        <plugin-configuration>
            <c:group name="connection" displayName="Connection Info">
                <c:simple-property name="host" default="localhost"/>
                <c:simple-property name="port" default="9100" type="integer"/>
                <c:simple-property name="principal" required="false"
                                   description="The name of the principal (i.e. user) to authenticate."/>
                <c:simple-property name="credentials" type="password" required="false"
                                   description="The credentials (i.e. password) that should be used to authenticate the principal."/>
                <c:simple-property name="loggingProvider" default="none"
                                   description="Specifies how log events are collected from the server. 'RasLoggingService' is supported out of the box by WebSphere. 'Extended Monitoring' requires deployment of the WebSphere Extended Monitoring EAR, but adds support for stack traces and correlating events with application components. In addition, it uses polling instead of JMX notifications.">
                    <c:property-options>
                        <c:option value="none" name="None"/>
                        <c:option value="ras" name="RasLoggingService"/>
                        <c:option value="xm" name="Extended Monitoring"/>
                    </c:property-options>
                </c:simple-property>
            </c:group>
            <c:group name="advanced" displayName="Advanced" hiddenByDefault="true">
                <c:simple-property name="childJmxServerName" displayName="WebSphere JVM Name" default="JVM"
                                   readOnly="true" required="false"
                                   description="The name of the WebSphere JVM resource."/>
            </c:group>
        </plugin-configuration>
        
        <operation name="restart" description="Restart the server process."/>
        
        <metric property="pid" displayName="PID" dataType="trait"
                displayType="summary" defaultOn="true"
                description="The process ID of the WebSphere JVM."/>
        
        <event name="ThreadMonitor" description="Thread monitor event"/>
        <event name="LogEvent" description="Logging message"/>
        
        <resource-configuration>
            <c:simple-property name="clusterName" displayName="Cluster Name" type="string" required="false" readOnly="true"
                               description="The name of the cluster the application server is a member of."/>
        </resource-configuration>
        
        <server name="WebSphere JVM"
                description="JVM of the WebSphere Application Server"
                sourcePlugin="JMX"
                sourceType="JMX Server"
                discovery="org.rhq.plugins.jmx.EmbeddedJMXServerDiscoveryComponent"
                class="org.rhq.plugins.jmx.JMXServerComponent"
                singleton="true"/>

        <service name="UNIX Process"
                 discovery="be.fgov.kszbcss.rhq.websphere.component.xm.UnixProcessDiscoveryComponent"
                 class="be.fgov.kszbcss.rhq.websphere.component.xm.UnixProcessComponent"
                 description="UNIX Process Statistics"
                 singleton="true">
            <metric property="stats.FileDescriptors" displayName="File Descriptors"
                    category="utilization" displayType="summary" defaultInterval="120000"
                    description="The number of file descriptors used by the process."/>
        </service>
        
        <service name="Thread Pool"
                 discovery="be.fgov.kszbcss.rhq.websphere.component.server.ThreadPoolDiscoveryComponent"
                 class="be.fgov.kszbcss.rhq.websphere.component.server.ThreadPoolComponent"
                 description="WebSphere Thread Pool">
    
            <metric property="stats.PoolSize" displayName="Pool size"
                    category="utilization" displayType="summary" defaultInterval="600000"
                    description="The average number of threads in a pool."/>
            <metric property="stats.PercentMaxed" displayName="% Maxed"
                    category="utilization" units="percentage" defaultInterval="600000"
                    description="The average percent of the time that all threads are in use."/>
            <metric property="stats.ConcurrentHungThreadCount" displayName="Hung Thread Count"
                    category="performance" displayType="summary" defaultInterval="600000"
                    description="The number of concurrently stopped threads."/>
            <metric property="stats.ActiveTime" displayName="Avg. Active Time"
                    category="performance" units="milliseconds" displayType="summary" defaultInterval="600000"
                    description="The average time in milliseconds that the threads are in active state."/>
            <metric property="stats.CreateCount" displayName="Threads created"
                    category="utilization" defaultInterval="600000" measurementType="trendsup"
                    description="The total number of threads that are created."/>
            <metric property="stats.DestroyCount" displayName="Threads destroyed"
                    category="utilization" defaultInterval="600000" measurementType="trendsup"
                    description="The total number of threads that are destroyed."/>
            <!-- Since ActiveCount may fluctuate rapidly and only gives a snapshot value,
                 we use a lower default interval, but don't enable the metric by default -->
            <metric property="stats.ActiveCount" displayName="Active Threads"
                    category="utilization" defaultInterval="60000"
                    description="The number of concurrently active threads."/>
            <metric property="stats.DeclaredThreadHungCount" displayName="Threads Declared Hung"
                    category="performance" defaultInterval="600000" measurementType="trendsup"
                    description="The number of threads that are declared stopped."/>
            <metric property="stats.ClearedThreadHangCount" displayName="Hung Threads Cleared"
                    category="performance" defaultInterval="600000" measurementType="trendsup"
                    description="The number of thread stops that cleared."/>

            <resource-configuration>
                <c:simple-property name="minimumSize" displayName="Minimum Size" type="integer"
                                   description="Minimum size of the thread pool."/>
                <c:simple-property name="maximumSize" displayName="Maximum Size" type="integer"
                                   description="Maximum size of the thread pool."/>
                <c:simple-property name="inactivityTimeout" displayName="Inactivity Timeout" type="long"
                                   description="The number of milliseconds to keep threads alive waiting for a new request (-1 = infinite, 0 = immediate)."/>
                <c:simple-property name="growable" displayName="Growable" type="boolean"
                                   description="Allow the thread pool to grow past the maximum size."/>
            </resource-configuration>
        </service>
        <service name="DynaCache"
                 discovery="be.fgov.kszbcss.rhq.websphere.component.server.DynaCacheDiscoveryComponent"
                 class="be.fgov.kszbcss.rhq.websphere.component.server.DynaCacheComponent"
                 description="WebSphere Dynamic Cache">
    
            <operation name="clearCache" description="Clear the cache."/>
            
            <metric property="CacheHits" displayName="Cache Hits"
                    category="performance" displayType="summary" defaultInterval="600000" measurementType="trendsup"
                    description="The number of cache hits."/>
            <metric property="CacheMisses" displayName="Cache Misses"
                    category="performance" displayType="summary" defaultInterval="600000" measurementType="trendsup"
                    description="The number of cache misses."/>
            <metric property="MemoryCacheEntries" displayName="Memory Cache Entries"
                    category="utilization" displayType="summary" defaultInterval="600000"
                    description="The number of in-memory cache entries."/>
        </service>
        <service name="Datasource"
                 discovery="be.fgov.kszbcss.rhq.websphere.component.jdbc.DataSourceDiscoveryComponent"
                 class="be.fgov.kszbcss.rhq.websphere.component.jdbc.DataSourceComponent"
                 description="Datasource">
            <metric property="stats.PoolSize" displayName="Pool size"
                    category="utilization" displayType="summary" defaultInterval="600000"
                    description="The size of the connection pool."/>
            <metric property="stats.UseTime" displayName="Avg. Use Time"
                    category="performance" units="milliseconds" displayType="summary" defaultInterval="600000"
                    description="The average time in milliseconds that a connection is used"/>
            <metric property="stats.WaitTime" displayName="Avg. Wait Time"
                    category="performance" units="milliseconds" displayType="summary" defaultInterval="600000"
                    description="The average waiting time in milliseconds until a connection is granted"/>
            <metric property="stats.PercentUsed" displayName="% Used"
                    category="utilization" units="percentage" displayType="summary" defaultInterval="600000"
                    description="Average percent of the pool that is in use. The value is based on the total number of configured connections in the ConnectionPool, not the current number of connections."/>
            <metric property="stats.PercentMaxed" displayName="% Maxed"
                    category="utilization" units="percentage" displayType="summary" defaultInterval="600000"
                    description="The average percent of the time that all connections are in use."/>
            <metric property="stats.AllocateCount" displayName="Allocated Connections"
                    category="utilization" displayType="summary" defaultInterval="600000" measurementType="trendsup"
                    description="The total number of connections that are allocated."/>
            <metric property="stats.PrepStmtCacheDiscardCount" displayName="Disc. Prep. Stmt."
                    category="performance" displayType="summary" defaultInterval="600000" measurementType="trendsup"
                    description="The number of statements that are discarded because the cache is full."/>
            
            <resource-configuration>
                <c:simple-property name="loginTimeout" displayName="Login Timeout" type="integer" readOnly="true"
                                   description="Login timeout."/>
                <c:simple-property name="statementCacheSize" displayName="Statement Cache Size" type="integer" readOnly="true"
                                   description="The size of the prepared statement cache."/>
                <c:simple-property name="jtaEnabled" displayName="JTA Enabled" type="boolean" readOnly="true"
                                   description="Indicates whether JTA is enabled for this data source."/>
                <c:simple-property name="testConnection" displayName="Test Connection" type="boolean"
                                   description="Specifies to test pooled connections from the free pool."/>
                <c:simple-property name="testConnectionInterval" displayName="Test Connection Interval" type="integer"
                                   description="Specifies the retry interval for the connection pool that is down."/>
                <c:simple-property name="stuckTimerTime" displayName="Stuck Timer Frequence" type="integer"
                                   description="Frequency of stuck time thread."/>
                <c:simple-property name="stuckTime" displayName="Stuck Time" type="integer"
                                   description="Connection stuck time."/>
                <c:simple-property name="stuckThreshold" displayName="Stuck Threshold" type="integer"
                                   description="Number of connections threshold."/>
                <c:simple-property name="surgeThreshhold" displayName="Surge Threshold" type="integer"
                                   description="Connection creation will be restricted when this number is exceeded by the amount of surge time."/>
                <c:simple-property name="surgeCreationInterval" displayName="Surge Creation Interval" type="integer"
                                   description="A connection will be created every surge time seconds while in surge threshold mode."/>
                <c:simple-property name="connectionTimeout" displayName="Connection Timeout" type="integer"
                                   description="Interval, in seconds after which a connection request times out and a ConnectionWaitTimeoutException is thrown."/>
                <c:simple-property name="minConnections" displayName="Minimum Size" type="integer"
                                   description="The minimum number of managed connection that should be maintained for all cases except if agedTimeout is set."/>
                <c:simple-property name="maxConnections" displayName="Maximum Size" type="integer"
                                   description="The maximun number of managed connections that can be created in this connection pool."/>
                <c:simple-property name="purgePolicy" displayName="Purge Policy" type="string"
                                   description="Specifies how to purge the connections when a connection error occurs (EntirePool or FailingConnectionOnly)."/>
                <c:simple-property name="reapTime" displayName="Reap Time" type="integer"
                                   description="Interval in seconds between runs of the connection pool maintenance thread."/>
                <c:simple-property name="unusedTimeout" displayName="Unused Timeout" type="integer"
                                   description="Interval in seconds after which an unused connection is discarded by the connection pool maintenance thread."/>
                <c:simple-property name="agedTimeout" displayName="Aged Timeout" type="integer"
                                   description="Interval in seconds after which an unused aged connection is discarded by the connection pool maintenance thread."/>
            </resource-configuration>
            
            <service name="DB2 Monitor"
                     discovery="be.fgov.kszbcss.rhq.websphere.component.jdbc.db2.DB2MonitorDiscoveryComponent"
                     class="be.fgov.kszbcss.rhq.websphere.component.jdbc.db2.DB2MonitorComponent"
                     description="DB2 Monitor"
                     singleton="true">
                <plugin-configuration>
                    <c:simple-property name="principal" required="false"
                                       description="The name of the monitoring user."/>
                    <c:simple-property name="credentials" type="password" required="false"
                                       description="The credentials (i.e. password) for the monitoring user."/>
                </plugin-configuration>
                
                <metric property="rows_deleted" displayName="Rows Deleted"
                        category="utilization" defaultInterval="120000" measurementType="trendsup"
                        description="The number of row deletions attempted."/>
                <metric property="rows_inserted" displayName="Rows Inserted"
                        category="utilization" defaultInterval="120000" measurementType="trendsup"
                        description="The number of row insertions attempted."/>
                <metric property="rows_updated" displayName="Rows Updated"
                        category="utilization" defaultInterval="120000" measurementType="trendsup"
                        description="The number of row updates attempted."/>
                <metric property="rows_selected" displayName="Rows Selected"
                        category="utilization" defaultInterval="120000" measurementType="trendsup"
                        description="The number of rows that have been selected and returned to the application."/>
                <metric property="agent_usr_cpu_time" displayName="CPU Time"
                        category="utilization" units="milliseconds" defaultInterval="120000" measurementType="trendsup"
                        description="The CPU time consumed by the DB2 agents linked to this data source."/>
            </service>
        </service>
        <service name="Connection Factory"
                 discovery="be.fgov.kszbcss.rhq.websphere.component.j2c.J2CConnectionFactoryDiscoveryComponent"
                 class="be.fgov.kszbcss.rhq.websphere.component.j2c.J2CConnectionFactoryComponent"
                 description="Datasource">
            <metric property="stats.PoolSize" displayName="Pool size"
                    category="utilization" displayType="summary" defaultInterval="600000"
                    description="The size of the connection pool."/>
            <metric property="stats.UseTime" displayName="Avg. Use Time"
                    category="performance" units="milliseconds" displayType="summary" defaultInterval="600000"
                    description="The average time in milliseconds that a connection is used"/>
            <metric property="stats.WaitTime" displayName="Avg. Wait Time"
                    category="performance" units="milliseconds" displayType="summary" defaultInterval="600000"
                    description="The average waiting time in milliseconds until a connection is granted"/>
            <metric property="stats.PercentUsed" displayName="% Used"
                    category="utilization" units="percentage" displayType="summary" defaultInterval="600000"
                    description="Average percent of the pool that is in use. The value is based on the total number of configured connections in the ConnectionPool, not the current number of connections."/>
            <metric property="stats.PercentMaxed" displayName="% Maxed"
                    category="utilization" units="percentage" displayType="summary" defaultInterval="600000"
                    description="The average percent of the time that all connections are in use."/>
            <metric property="stats.AllocateCount" displayName="Allocated Connections"
                    category="utilization" displayType="summary" defaultInterval="600000" measurementType="trendsup"
                    description="The total number of connections that are allocated."/>
        </service>
        <service name="Outbound Connection Cache"
                 discovery="be.fgov.kszbcss.rhq.websphere.component.xm.OutboundConnectionCacheDiscoveryComponent"
                 class="be.fgov.kszbcss.rhq.websphere.component.xm.OutboundConnectionCacheComponent"
                 description="Outbound HTTP Connection Cache">
    
            <metric property="stats.ConnectionsInUse" displayName="Connections In Use"
                    category="utilization" displayType="summary" defaultInterval="60000"
                    description="The number of connections currently in use."/>
            <metric property="stats.PoolSize" displayName="Pool Size"
                    category="utilization" displayType="summary" defaultInterval="120000"
                    description="The current size of the pool."/>

            <resource-configuration>
                <c:simple-property name="maxConnection" displayName="Max Connections" type="integer" readOnly="true"
                                   description="The maximum number of connections in the pool."/>
                <c:simple-property name="connTimeout" displayName="Connection timeout" type="integer" readOnly="true"
                                   description="The connection timeout."/>
            </resource-configuration>
        </service>
        <service name="Application"
                 discovery="be.fgov.kszbcss.rhq.websphere.component.j2ee.ApplicationDiscoveryComponent"
                 class="be.fgov.kszbcss.rhq.websphere.component.j2ee.ApplicationComponent"
                 description="Application (EAR)">
            
            <operation name="start" description="Start the application."/>
            <operation name="stop" description="Stop the application."/>
            
            <metric property="implementationVersion" displayName="Version" dataType="trait"
                    displayType="summary" defaultOn="true"
                    description="The version of the application instance currently running."/>
            
            <event name="StateChange" description="State change events"/>
            
            <service name="Web module"
                     discovery="be.fgov.kszbcss.rhq.websphere.component.j2ee.web.WebModuleDiscoveryComponent"
                     class="be.fgov.kszbcss.rhq.websphere.component.j2ee.web.WebModuleComponent"
                     description="Web module">
                
                <service name="Servlet"
                         discovery="be.fgov.kszbcss.rhq.websphere.component.j2ee.web.ServletDiscoveryComponent"
                         class="be.fgov.kszbcss.rhq.websphere.component.j2ee.web.ServletComponent"
                         description="Servlet">
                    <plugin-configuration>
                        <c:simple-property name="objectName" readOnly="true" default="WebSphere:name=%name%,WebModule={moduleName},Application={applicationName},type=Servlet"/>
                        <c:simple-property name="nameTemplate" default="{name}"/>
                        <c:simple-property name="descriptionTemplate" default="A servlet."/>
                        <c:simple-property name="name" readOnly="true" type="string" description="The name of this servlet"/>
                    </plugin-configuration>
                    
                    <metric property="stats.ServiceTime" displayName="Avg. Servlet Resp. Time"
                            category="performance" units="milliseconds" displayType="summary" defaultInterval="600000"
                            description="Average response time of a servlet"/>
                    <metric property="stats.ErrorCount" displayName="Error Count"
                            category="availability" displayType="summary" defaultInterval="600000" measurementType="trendsup"
                            description="The total number of times an error has been received from the servlet or JSP."/>
                    <metric property="stats.RequestCount" displayName="Request Count"
                            category="utilization" displayType="summary" defaultInterval="600000" measurementType="trendsup"
                            description="The number of requests received by the servlet"/>
                    <metric property="stats.ConcurrentRequests" displayName="Concurrent Requests"
                            category="utilization" defaultInterval="60000"
                            description="The number of requests that are concurrently processed."/>
                    
                    <event name="LogEvent" description="Logging message"/>
                </service>
            </service>
            
            <service name="EJB module"
                     discovery="be.fgov.kszbcss.rhq.websphere.component.j2ee.ejb.EJBModuleDiscoveryComponent"
                     class="be.fgov.kszbcss.rhq.websphere.component.j2ee.ejb.EJBModuleComponent"
                     description="EJB module">
                
                <service name="Stateless Session Bean"
                         discovery="be.fgov.kszbcss.rhq.websphere.component.j2ee.ejb.StatelessSessionBeanDiscoveryComponent"
                         class="be.fgov.kszbcss.rhq.websphere.component.j2ee.ejb.StatelessSessionBeanComponent"
                         description="Stateless Session Bean">
                    <metric property="stats.MethodResponseTime" displayName="Avg. Method Resp. Time"
                            category="performance" units="milliseconds" displayType="summary" defaultInterval="600000"
                            description="The average response time in milliseconds on the remote methods of the bean"/>
                    <metric property="stats.MethodCallCount" displayName="Method Call Count"
                            category="utilization" displayType="summary" defaultInterval="600000" measurementType="trendsup"
                            description="The number of calls to the remote methods of the bean"/>
                    
                    <event name="LogEvent" description="Logging message"/>
                </service>
                <service name="Message Driven Bean"
                         discovery="be.fgov.kszbcss.rhq.websphere.component.j2ee.ejb.MessageDrivenBeanDiscoveryComponent"
                         class="be.fgov.kszbcss.rhq.websphere.component.j2ee.ejb.MessageDrivenBeanComponent"
                         description="Message Driven Bean">
                    <metric property="stats.MethodResponseTime" displayName="Avg. Method Resp. Time"
                            category="performance" units="milliseconds" displayType="summary" defaultInterval="600000"
                            description="The average response time in milliseconds on the remote methods of the bean"/>
                    <metric property="stats.MessageCount" displayName="Message Count"
                            category="utilization" displayType="summary" defaultInterval="600000" measurementType="trendsup"
                            description="The number of messages delivered to the onMessage method of the bean"/>
                    <metric property="stats.LiveCount" displayName="Live Count"
                            category="utilization" defaultInterval="600000"
                            description="The average number of concurrently live beans."/>
                    <metric property="stats.ActiveMethodCount" displayName="Active Method Count"
                            category="utilization" defaultInterval="60000"
                            description="The average number of concurrently active methods (that is, the num methods called at the same time)."/>
                    
                    <event name="LogEvent" description="Logging message"/>
                </service>
            </service>
        </service>
        
        <service name="Messaging Engine"
                 discovery="be.fgov.kszbcss.rhq.websphere.component.sib.SIBMessagingEngineDiscoveryComponent"
                 class="be.fgov.kszbcss.rhq.websphere.component.sib.SIBMessagingEngineComponent"
                 description="SIBus Messaging Engine">
            
            <metric property="health" displayName="Health" dataType="trait"
                    displayType="summary" defaultOn="true"
                    description="The current Health of the Messaging Engine."/>
            
            <service name="Queue"
                     discovery="be.fgov.kszbcss.rhq.websphere.component.sib.SIBQueuePointDiscoveryComponent"
                     class="be.fgov.kszbcss.rhq.websphere.component.sib.SIBQueuePointComponent"
                     description="SIBus Queue">
                
                <metric property="stats.TotalMessagesProducedCount" displayName="Total Msg. Produced"
                        category="utilization" displayType="summary" defaultInterval="600000" measurementType="trendsup"
                        description="Total number of messages produced to this queue."/>
                <metric property="stats.TotalMessagesConsumedCount" displayName="Total Msg. Consumed"
                        category="utilization" displayType="summary" defaultInterval="600000" measurementType="trendsup"
                        description="Total number of messages consumed from this queue."/>
                <metric property="stats.AvailableMessageCount" displayName="Avail. Msg. Count"
                        category="utilization" displayType="summary" defaultInterval="600000"
                        description="Number of messages available for consumption from this queue."/>
                <metric property="stats.UnavailableMessageCount" displayName="Unavail. Msg. Count"
                        category="utilization" displayType="summary" defaultInterval="600000"
                        description="Number of messages on this queue but not available for consumption."/>
            </service>
        </service>
    </server>
    
    <service name="WebSphere Connector Subsystem"
             discovery="be.fgov.kszbcss.rhq.websphere.connector.agent.ConnectorSubsystemDiscoveryComponent"
             class="be.fgov.kszbcss.rhq.websphere.connector.agent.ConnectorSubsystemComponent"
             description="WebSphere Connector Subsystem"
             singleton="true">
        
        <runs-inside>
            <parent-resource-type name="RHQ Agent" plugin="RHQAgent"/>
        </runs-inside>
        
        <metric property="InvocationTime" dataType="calltime" units="milliseconds"
                defaultOn="false" defaultInterval="600000" destinationType="Operation/Attribute Name"
                description="The minimum, maximum, and average invocation times for JMX invocations."/>
        
        <content name="certificate" displayName="Certificate" category="configuration"
                 description="Trusted certificate"/>
    </service>
</plugin>
