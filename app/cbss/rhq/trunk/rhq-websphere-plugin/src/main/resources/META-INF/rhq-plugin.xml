<?xml version="1.0" encoding="UTF-8" ?>
<plugin name="WebSphere"
        displayName="WebSphere Application Server"
        package="be.fgov.kszbcss.websphere.rhq"
        description="Supports management and monitoring of WebSphere Application Server"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns="urn:xmlns:rhq-plugin"
        xmlns:c="urn:xmlns:rhq-configuration">
    <depends plugin="JMX"/>
    <server name="WebSphere Server"
            discovery="WebSphereServerDiscoveryComponent"
            class="WebSphereServerComponent"
            description="WebSphere Application Server"
            supportsManualAdd="true">
        
        <plugin-configuration>
            <c:group name="connection" displayName="Connection Info">
                <c:simple-property name="host" default="localhost"/>
                <c:simple-property name="port" default="9100" type="integer"/>
                <c:simple-property name="principal" required="false"
                                   description="The name of the principal (i.e. user) to authenticate."/>
                <c:simple-property name="credentials" type="password" required="false"
                                   description="The credentials (i.e. password) that should be used to authenticate the principal."/>
            </c:group>
            <c:group name="advanced" displayName="Advanced" hiddenByDefault="true">
                <c:simple-property name="childJmxServerName" displayName="WebSphere JVM Name" default="JVM"
                                   readOnly="true" required="false"
                                   description="The name of the WebSphere JVM resource."/>
            </c:group>
        </plugin-configuration>
        
        <event name="RasMessage" description="RAS logging message"/>
        <event name="ThreadMonitor" description="Thread monitor event"/>
        
        <server name="WebSphere JVM"
                description="JVM of the WebSphere Application Server"
                sourcePlugin="JMX"
                sourceType="JMX Server"
                discovery="org.rhq.plugins.jmx.EmbeddedJMXServerDiscoveryComponent"
                class="org.rhq.plugins.jmx.JMXServerComponent"
                singleton="true"/>

        <service name="Thread Pool"
                 discovery="ThreadPoolDiscoveryComponent"
                 class="ThreadPoolComponent"
                 description="WebSphere Thread Pool">
    
            <metric property="stats.PoolSize" displayName="Pool size"
                    category="utilization" displayType="summary" defaultInterval="600000"
                    description="The average number of threads in a pool."/>
            <metric property="stats.PercentMaxed" displayName="% Maxed"
                    category="utilization" units="percentage" defaultInterval="600000"
                    description="The average percent of the time that all threads are in use."/>
            <metric property="stats.ConcurrentHungThreadCount" displayName="Hung Thread Count"
                    category="performance" displayType="summary" defaultInterval="600000"
                    description="The number of concurrently stopped threads."/>
        </service>
        <service name="DynaCache"
                 discovery="DynaCacheDiscoveryComponent"
                 class="DynaCacheComponent"
                 description="WebSphere Dynamic Cache">
    
            <operation name="clearCache" description="Clear the cache."/>
            
            <metric property="CacheHits" displayName="Cache Hits"
                    category="performance" displayType="summary" defaultInterval="600000" measurementType="trendsup"
                    description="The number of cache hits."/>
            <metric property="CacheMisses" displayName="Cache Misses"
                    category="performance" displayType="summary" defaultInterval="600000" measurementType="trendsup"
                    description="The number of cache misses."/>
            <metric property="MemoryCacheEntries" displayName="Memory Cache Entries"
                    category="utilization" displayType="summary" defaultInterval="600000"
                    description="The number of in-memory cache entries."/>
        </service>
        <service name="Datasource"
                 discovery="DataSourceDiscoveryComponent"
                 class="DataSourceComponent"
                 description="Datasource">
            <metric property="stats.UseTime" displayName="Avg. Use Time"
                    category="performance" units="milliseconds" displayType="summary" defaultInterval="600000"
                    description="The average time in milliseconds that a connection is used"/>
            <metric property="stats.WaitTime" displayName="Avg. Wait Time"
                    category="performance" units="milliseconds" displayType="summary" defaultInterval="600000"
                    description="The average waiting time in milliseconds until a connection is granted"/>
            <!-- metric property="stats.PercentUsed" displayName="% Used"
                    category="utilization" units="percentage" displayType="summary" defaultInterval="600000"
                    description="Average percent of the pool that is in use. The value is based on the total number of configured connections in the ConnectionPool, not the current number of connections."/ -->
            <metric property="stats.PercentMaxed" displayName="% Maxed"
                    category="utilization" units="percentage" displayType="summary" defaultInterval="600000"
                    description="The average percent of the time that all connections are in use."/>
            <metric property="stats.AllocateCount" displayName="Allocated Connections"
                    category="utilization" displayType="summary" defaultInterval="600000" measurementType="trendsup"
                    description="The total number of connections that are allocated."/>
            <metric property="stats.PrepStmtCacheDiscardCount" displayName="Disc. Prep. Stmt."
                    category="performance" displayType="summary" defaultInterval="600000" measurementType="trendsup"
                    description="The number of statements that are discarded because the cache is full."/>
        </service>
        <service name="Application"
                 discovery="ApplicationDiscoveryComponent"
                 class="ApplicationComponent"
                 description="Application (EAR)">
            
            <event name="StateChange" description="State change events"/>
            
            <service name="Web module"
                     discovery="WebModuleDiscoveryComponent"
                     class="WebModuleComponent"
                     description="Web module">
    
                <service name="Servlet"
                         discovery="ServletDiscoveryComponent"
                         class="ServletComponent"
                         description="Servlet">
                    <plugin-configuration>
                        <c:simple-property name="objectName" readOnly="true" default="WebSphere:name=%name%,WebModule={moduleName},Application={applicationName},type=Servlet"/>
                        <c:simple-property name="nameTemplate" default="{name}"/>
                        <c:simple-property name="descriptionTemplate" default="A servlet."/>
                        <c:simple-property name="name" readOnly="true" type="string" description="The name of this servlet"/>
                    </plugin-configuration>
                    
                    <metric property="stats.ServiceTime" displayName="Avg. Servlet Resp. Time"
                            category="performance" units="milliseconds" displayType="summary" defaultInterval="600000"
                            description="Average response time of a servlet"/>
                    <metric property="stats.ErrorCount" displayName="Error Count"
                            category="availability" displayType="summary" defaultInterval="600000" measurementType="trendsup"
                            description="The total number of times an error has been received from the servlet or JSP."/>
                    <metric property="stats.RequestCount" displayName="Request Count"
                            category="utilization" displayType="summary" defaultInterval="600000" measurementType="trendsup"
                            description="The number of requests received by the servlet"/>
                </service>
            </service>
            
            <service name="EJB module"
                     discovery="EJBModuleDiscoveryComponent"
                     class="EJBModuleComponent"
                     description="EJB module">
    
                <service name="Stateless Session Bean"
                         discovery="StatelessSessionBeanDiscoveryComponent"
                         class="StatelessSessionBeanComponent"
                         description="Stateless Session Bean">
                    <metric property="stats.MethodResponseTime" displayName="Avg. Method Resp. Time"
                            category="performance" units="milliseconds" displayType="summary" defaultInterval="600000"
                            description="The average response time in milliseconds on the remote methods of the bean"/>
                    <metric property="stats.MethodCallCount" displayName="Method Call Count"
                            category="utilization" displayType="summary" defaultInterval="600000" measurementType="trendsup"
                            description="The number of calls to the remote methods of the bean"/>
                </service>
                <service name="Message Driven Bean"
                         discovery="MessageDrivenBeanDiscoveryComponent"
                         class="MessageDrivenBeanComponent"
                         description="Message Driven Bean">
                    <metric property="stats.MethodResponseTime" displayName="Avg. Method Resp. Time"
                            category="performance" units="milliseconds" displayType="summary" defaultInterval="600000"
                            description="The average response time in milliseconds on the remote methods of the bean"/>
                    <metric property="stats.MessageCount" displayName="Message Count"
                            category="utilization" displayType="summary" defaultInterval="600000" measurementType="trendsup"
                            description="The number of messages delivered to the onMessage method of the bean"/>
                </service>
            </service>
        </service>
    </server>
</plugin>
