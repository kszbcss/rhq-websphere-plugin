<?xml version="1.0" encoding="UTF-8" ?>
<plugin name="WebSphere"
        displayName="WebSphere Application Server"
        package="be.fgov.kszbcss.websphere.rhq"
        description="Supports management and monitoring of WebSphere Application Server"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns="urn:xmlns:rhq-plugin"
        xmlns:c="urn:xmlns:rhq-configuration">
    <depends plugin="JMX"/>
    <service name="Thread Pool"
             discovery="WebSphereMBeanResourceDiscoveryComponent"
             class="StatsEnabledMBeanResourceComponent"
             description="WebSphere Thread Pool">

        <runs-inside>
            <parent-resource-type name="JMX Server" plugin="JMX"/>
        </runs-inside>

        <plugin-configuration>
            <c:simple-property name="objectName" readOnly="true" default="WebSphere:name=%name%,type=ThreadPool"/>
            <c:simple-property name="nameTemplate" default="{name}"/>
            <c:simple-property name="descriptionTemplate" default="A thread pool."/>
            <c:simple-property name="name" type="string" description="The name of this thread pool"/>
        </plugin-configuration>
        
        <metric displayName="Pool size" property="stats.PoolSize.current"
                category="utilization" defaultOn="true" displayType="summary"
                description="The average number of threads in a pool."/>
    </service>
    <service name="JDBC Provider"
             discovery="JDBCProviderDiscoveryComponent"
             class="org.rhq.plugins.jmx.MBeanResourceComponent"
             description="JDBC Provider">

        <runs-inside>
            <parent-resource-type name="JMX Server" plugin="JMX"/>
        </runs-inside>

        <plugin-configuration>
            <c:simple-property name="objectName" readOnly="true" default="WebSphere:name=%providerName%,type=JDBCProvider"/>
            <c:simple-property name="nameTemplate" default="{providerName}"/>
            <c:simple-property name="descriptionTemplate" default="A JDBC provider."/>
            <c:simple-property name="providerName" type="string" description="The name of the JDBC provider"/>
        </plugin-configuration>

        <service name="Datasource"
                 discovery="DataSourceDiscoveryComponent"
                 class="DataSourceComponent"
                 description="Datasource">
            <plugin-configuration>
                <!-- Data sources related to the parent resource (i.e. JDBC provider) will be filtered out
                     by DataSourceDiscoveryComponent -->
                <c:simple-property name="objectName" readOnly="true" default="WebSphere:name=%name%,type=DataSource"/>
                <c:simple-property name="nameTemplate" default="{name}"/>
                <c:simple-property name="descriptionTemplate" default="A data source."/>
                <c:simple-property name="name" readOnly="true" type="string" description="The data source name"/>
            </plugin-configuration>
            
            <metric property="stats.UseTime.mean" displayName="Avg. Use Time"
                    category="performance" units="milliseconds" displayType="summary" defaultInterval="600000"
                    description="The average time in milliseconds that a connection is used"/>
            <metric property="stats.PercentUsed.current" displayName="% Used"
                    category="utilization" units="percentage" displayType="summary" defaultInterval="600000"
                    description="Average percent of the pool that is in use. The value is based on the total number of configured connections in the ConnectionPool, not the current number of connections."/>
        </service>
    </service>
    <service name="Application"
             discovery="ApplicationDiscoveryComponent"
             class="org.rhq.plugins.jmx.MBeanResourceComponent"
             description="Application (EAR)">
        
        <runs-inside>
            <parent-resource-type name="JMX Server" plugin="JMX"/>
        </runs-inside>
        
        <plugin-configuration>
            <c:simple-property name="objectName" readOnly="true" default="WebSphere:name=%applicationName%,type=Application"/>
            <c:simple-property name="nameTemplate" default="{applicationName}"/>
            <c:simple-property name="descriptionTemplate" default="An enterprise application."/>
            <c:simple-property name="applicationName" readOnly="true" type="string" description="The application name used internally by WebSphere"/>
        </plugin-configuration>
        
        <service name="Web module"
                 discovery="ModuleDiscoveryComponent"
                 class="org.rhq.plugins.jmx.MBeanResourceComponent"
                 description="Web module">
            <plugin-configuration>
                <c:simple-property name="objectName" readOnly="true" default="WebSphere:name=%moduleName%,Application={applicationName},type=WebModule"/>
                <c:simple-property name="nameTemplate" default="{moduleName}"/>
                <c:simple-property name="descriptionTemplate" default="A Web module."/>
                <!-- The applicationName property is necessary to make the correlation with child resources
                     (because the moduleName is not unique) -->
                <c:simple-property name="applicationName" readOnly="true" type="string" description="The application name used internally by WebSphere"/>
                <c:simple-property name="moduleName" readOnly="true" type="string" description="The module name used internally by WebSphere"/>
            </plugin-configuration>

            <service name="Servlet"
                     discovery="WebSphereMBeanResourceDiscoveryComponent"
                     class="StatsEnabledMBeanResourceComponent"
                     description="Servlet">
                <plugin-configuration>
                    <c:simple-property name="objectName" readOnly="true" default="WebSphere:name=%name%,WebModule={moduleName},Application={applicationName},type=Servlet"/>
                    <c:simple-property name="nameTemplate" default="{name}"/>
                    <c:simple-property name="descriptionTemplate" default="A servlet."/>
                    <c:simple-property name="name" readOnly="true" type="string" description="The name of this servlet"/>
                </plugin-configuration>
                
                <metric property="stats.webAppModule.servlets.responseTime.minTime" displayName="Min. Servlet Resp. Time"
                        units="milliseconds"
                        description="Minimum response time of a servlet"/>
        
                <metric property="stats.webAppModule.servlets.responseTime.maxTime" displayName="Max. Servlet Resp. Time"
                        units="milliseconds"
                        description="Maximum response time of a servlet"/>
            </service>
        </service>
        
        <service name="EJB module"
                 discovery="ModuleDiscoveryComponent"
                 class="org.rhq.plugins.jmx.MBeanResourceComponent"
                 description="EJB module">
            <plugin-configuration>
                <c:simple-property name="objectName" readOnly="true" default="WebSphere:name=%moduleName%,Application={applicationName},type=EJBModule"/>
                <c:simple-property name="nameTemplate" default="{moduleName}"/>
                <c:simple-property name="descriptionTemplate" default="An EJB module."/>
                <!-- The applicationName property is necessary to make the correlation with child resources
                     (because the moduleName is not unique) -->
                <c:simple-property name="applicationName" readOnly="true" type="string" description="The application name used internally by WebSphere"/>
                <c:simple-property name="moduleName" readOnly="true" type="string" description="The module name used internally by WebSphere"/>
            </plugin-configuration>

            <service name="Stateless Session Bean"
                     discovery="WebSphereMBeanResourceDiscoveryComponent"
                     class="StatsEnabledMBeanResourceComponent"
                     description="Stateless Session Bean">
                <plugin-configuration>
                    <c:simple-property name="objectName" readOnly="true" default="WebSphere:name=%name%,EJBModule={moduleName},Application={applicationName},type=StatelessSessionBean"/>
                    <c:simple-property name="nameTemplate" default="{name}"/>
                    <c:simple-property name="descriptionTemplate" default="A servlet."/>
                    <c:simple-property name="name" readOnly="true" type="string" description="The name of this EJB"/>
                </plugin-configuration>
                
                <metric property="stats.MethodResponseTime.mean" displayName="Avg. Method Resp. Time"
                        units="milliseconds" defaultOn="true"
                        description="The average response time in milliseconds on the remote methods of the bean"/>
            </service>
        </service>
    </service>
</plugin>
